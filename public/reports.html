<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reports & Analytics - Dex Arbitrage</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/bundle.css" />
    <script src="/auth-check.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" as="style" onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"></noscript>
  </head>
        <body data-page="reports">
    <header class="app-header">
      <div class="brand-block" id="brand">
        <img class="brand-img" src="/color_logo.png" onerror="this.src='/color_logo.svg'" alt="Logo" />
        <div class="brand-text">
          <span class="brand-title">DEX Arbitrage</span>
          <span class="page-label">Reports & Analytics</span>
        </div>
      </div>
      <div class="primary-nav">
        <button id="nav-dropdown-button" class="icon-btn nav-toggle" aria-haspopup="true" aria-controls="nav-dropdown" aria-expanded="false" aria-label="Toggle navigation">&#9776;</button>
        <nav class="nav-dropdown" id="nav-dropdown" aria-label="Primary navigation">
          <a class="nav-link" data-route="dashboard" href="/">Dashboard</a>
          <a class="nav-link" data-route="pair-analysis" href="/pair-analysis.html">Pair Analysis</a>
          <a class="nav-link" data-route="token-analysis" href="/token-analysis.html">Token Analysis</a>
          <a class="nav-link" data-route="diff-analysis" href="/diff-analysis.html">Diff Analysis</a>
          <a class="nav-link" data-route="contract-analysis" href="/contract-analysis.html">Contract Analysis</a>

          <a class="nav-link" data-route="reports" href="/reports.html">Reports &amp; Analytics</a>
          <a class="nav-link requires-admin" data-route="consolidated" href="/consolidated-tracking.html" data-requires-role="admin">Consolidated Tracking</a>
        </nav>
      </div>
      <div class="header-actions">
        <button id="theme-switcher" class="icon-btn" title="Toggle Theme" aria-label="Toggle theme">&#127769;</button>
        <label class="field">
          <span class="field-label">Server</span>
          <select id="serverSelect"></select>
        </label>
        <a class="icon-btn" href="/docs.html" title="Documentation" aria-label="Documentation">&#128218;</a>
        <a class="icon-btn requires-admin" href="/servers.html" data-requires-role="admin" title="Server settings" aria-label="Server settings">&#9881;</a>
        <a class="icon-btn" href="/notifications.html" title="Notifications" aria-label="Notifications">&#128276;</a>
        <button class="icon-btn logout-btn" data-action="logout" title="Log out" aria-label="Log out">&#128274;</button>
      </div>
    </header>
    <main class="reports-main full-screen-main">
      <div class="reports-layout">
        <aside class="card filter-panel" aria-label="Filter panel">
          <div class="filter-panel-header">
            <h2>Filters</h2>
            <span id="filters-summary" class="muted"></span>
          </div>
          <div class="filter-group">
            <label for="timePreset">Time Range Preset</label>
            <select id="timePreset">
              <option value="24h">Last 24h</option>
              <option value="7d" selected>Last 7d</option>
              <option value="30d">Last 30d</option>
              <option value="ytd">Year to Date</option>
              <option value="all">All</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="filter-group time-custom" id="customRangeGroup">
            <label>Custom Range</label>
            <input type="datetime-local" id="timeStart" aria-label="Start time" />
            <input type="datetime-local" id="timeEnd" aria-label="End time" />
          </div>
          <div class="filter-group">
            <label for="tokenFilter">Token (props.Token)</label>
            <select id="tokenFilter" multiple size="6"></select>
          </div>
          <div class="filter-group">
            <label for="execFilter">Execution Type (props.Exec)</label>
            <select id="execFilter" multiple size="4"></select>
          </div>
          <div class="filter-group">
            <label for="dexFilter">Dex Side (props.Dex)</label>
            <select id="dexFilter" multiple size="3"></select>
          </div>
          <div class="filter-group">
            <label for="hedgeFilter">Hedge Mode</label>
            <select id="hedgeFilter">
              <option value="all">All Trades</option>
              <option value="hedge">Hedge Only</option>
              <option value="non-hedge">Non-Hedge Only</option>
            </select>
          </div>
          <div class="filter-group filter-range">
            <label>Diff (props.Diff)</label>
            <div class="range-inputs">
              <input type="number" id="diffMin" step="0.01" placeholder="Min" />
              <input type="number" id="diffMax" step="0.01" placeholder="Max" />
            </div>
          </div>
          <div class="filter-group filter-range">
            <label>Dex Slip (props.DexSlip)</label>
            <div class="range-inputs">
              <input type="number" id="dexSlipMin" step="0.01" placeholder="Min" />
              <input type="number" id="dexSlipMax" step="0.01" placeholder="Max" />
            </div>
          </div>
          <div class="filter-group filter-range">
            <label>Cex Slip (props.CexSlip)</label>
            <div class="range-inputs">
              <input type="number" id="cexSlipMin" step="0.01" placeholder="Min" />
              <input type="number" id="cexSlipMax" step="0.01" placeholder="Max" />
            </div>
          </div>
          <div class="filter-group filter-range">
            <label>LHdelta (props.LHdelta)</label>
            <div class="range-inputs">
              <input type="number" id="lhDeltaMin" step="0.01" placeholder="Min" />
              <input type="number" id="lhDeltaMax" step="0.01" placeholder="Max" />
            </div>
          </div>
          <div class="filter-actions">
            <div class="saved-views">
              <label for="savedViews">
                Saved Views
                <select id="savedViews">
                  <option value="">Load view…</option>
                </select>
              </label>
            </div>
            <div class="filter-buttons">
              <button id="applyFilters" class="btn-orange" type="button">Apply Filters</button>
              <button id="resetFilters" class="btn" type="button">Reset</button>
              <button id="saveViewBtn" class="btn" type="button">Save View</button>
            </div>
          </div>
        </aside>
        <section class="reports-content">
          <div class="card">
            <div class="reports-header">
              <div>
                <h2>Overview</h2>
                <p class="muted">Slice completed trades &amp; balances to monitor health, risk, and performance.</p>
              </div>
              <div class="reports-tabs" role="tablist">
                <button class="tab-btn active" type="button" data-tab="overview">Overview</button>
                <button class="tab-btn" type="button" data-tab="pair">By Pair / Exchange</button>
                <button class="tab-btn" type="button" data-tab="time">Time Patterns</button>
                <button class="tab-btn" type="button" data-tab="market">Market Context</button>
                <button class="tab-btn" type="button" data-tab="gas">Gas &amp; Ops</button>
              </div>
            </div>
            <div id="reports-status" class="muted" role="status">Ready.</div>
          </div>

          <div class="tab-panel active" data-tab-panel="overview">
          <section class="card">
            <h2>KPI Strip</h2>
            <div class="kpi-grid">
              <article class="kpi-card" tabindex="0">
                <span class="kpi-label">Total Net PnL</span>
                <strong data-kpi="netPnl">—</strong>
                <small class="muted">after fees &amp; tx</small>
              </article>
              <article class="kpi-card" tabindex="0">
                <span class="kpi-label">Win Rate</span>
                <strong data-kpi="winRate">—</strong>
                <small class="muted">wins / total trades</small>
              </article>
              <article class="kpi-card" tabindex="0">
                <span class="kpi-label"># Trades</span>
                <strong data-kpi="trades">—</strong>
                <small class="muted"><span data-kpi="wins">0</span> wins · <span data-kpi="losses">0</span> losses</small>
              </article>
              <article class="kpi-card" tabindex="0">
                <span class="kpi-label">Avg PnL / Trade</span>
                <strong data-kpi="avgPnl">—</strong>
                <small class="muted">Mean net PnL</small>
              </article>
              <article class="kpi-card" tabindex="0">
                <span class="kpi-label">Median PnL</span>
                <strong data-kpi="medianPnl">—</strong>
                <small class="muted">Middle trade</small>
              </article>
              <article class="kpi-card" tabindex="0">
                <span class="kpi-label">Max Drawdown</span>
                <strong data-kpi="maxDrawdown">—</strong>
                <small class="muted">Peak-to-trough</small>
              </article>
              <article class="kpi-card" tabindex="0">
                <span class="kpi-label">Sharpe-like</span>
                <strong data-kpi="sharpe">—</strong>
                <small class="muted">Daily returns / σ</small>
              </article>
            </div>
          </section>

          <section class="card">
            <div class="card-header chart-header">
              <div>
                <h2>Equity Curves</h2>
                <p class="muted">Overlay balance snapshots against trade-based PnL to reveal drawdowns.</p>
              </div>
              <button id="reloadReports" class="btn" type="button">Reload Data</button>
            </div>
            <div class="grid-2 stacked-on-mobile">
              <div>
                <h3>Balance-based Equity</h3>
                <div class="chart-container medium-chart">
                  <canvas id="balancesEquityChart" aria-label="Balance equity chart"></canvas>
                </div>
              </div>
              <div>
                <h3>Trade-based Cumulative PnL</h3>
                <div class="chart-container medium-chart">
                  <canvas id="tradeEquityChart" aria-label="Trade equity chart"></canvas>
                </div>
              </div>
            </div>
          </section>

          <section class="card">
            <h2>Trade Quality</h2>
            <div class="grid-2 stacked-on-mobile">
              <div>
                <h3>Net PnL Distribution</h3>
                <div class="chart-container medium-chart">
                  <canvas id="pnlHistogram"></canvas>
                </div>
              </div>
              <div>
                <h3>Return per Trade</h3>
                <div class="chart-container medium-chart">
                  <canvas id="returnHistogram"></canvas>
                </div>
              </div>
            </div>
          </section>

          <section class="card">
            <div class="card-header">
              <div>
                <h2>Trade Ledger</h2>
                <p class="muted">Paginated, filter-aware ledger with export options.</p>
              </div>
              <div class="reports-table-actions">
                <button id="exportTradesCsv" class="btn" type="button">Export Trades CSV</button>
                <button id="exportSummaryCsv" class="btn" type="button">Export Summary CSV</button>
                <button id="generateReportBtn" class="btn-orange" type="button">Generate Consolidated Report</button>
              </div>
            </div>
            <div class="table-wrap">
              <table id="tradesTable">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Token</th>
                    <th>Net Profit</th>
                    <th>LHdelta</th>
                    <th>Exec</th>
                    <th>CexSlip</th>
                    <th>Dex</th>
                    <th>Diff</th>
                    <th>DexSlip</th>
                  </tr>
                </thead>
                <tbody id="tradesBody">
                  <tr><td colspan="9" class="muted">No trades loaded yet.</td></tr>
                </tbody>
              </table>
            </div>
            <div class="table-pagination" id="tradesPagination">
              <button id="prevPage" class="btn" type="button">Prev</button>
              <span id="tradesPageInfo">Page 1 / 1</span>
              <button id="nextPage" class="btn" type="button">Next</button>
            </div>
          </section>
          </div>

          <div class="tab-panel" data-tab-panel="pair">
            <section class="card">
              <div class="card-header">
                <div>
                  <h2>Pairs Performance</h2>
                  <p class="muted">Aggregate profitability and hit-rate per market pair across the filtered trades.</p>
                </div>
                <button id="exportPairsCsv" class="btn" type="button">Export CSV</button>
              </div>
              <p id="pairBreakdownSummary" class="muted breakdown-summary">Apply filters to load pair breakdowns.</p>
              <div class="table-wrap">
                <table id="pairBreakdownTable">
                  <thead>
                    <tr>
                      <th>Pair</th>
                      <th>Trades</th>
                      <th>Win Rate</th>
                      <th>Net PnL</th>
                      <th>Avg PnL</th>
                      <th>Volume</th>
                    </tr>
                  </thead>
                  <tbody id="pairBreakdownBody">
                    <tr><td colspan="6" class="muted">No data yet.</td></tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>

          <div class="tab-panel" data-tab-panel="time">
            <section class="card">
              <div class="card-header">
                <div>
                  <h2>Time Patterns</h2>
                  <p class="muted">Track when trades cluster and whether specific days deliver outsized PnL.</p>
                </div>
              </div>
              <p id="timePatternsSummary" class="muted breakdown-summary">Apply filters to load time patterns.</p>
              <div class="chart-container large-chart">
                <canvas id="timePnlChart" aria-label="Net PnL over time"></canvas>
              </div>
            </section>

            <section class="card">
              <h3>Day-of-Week Performance</h3>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>Day</th>
                      <th>Trades</th>
                      <th>Win Rate</th>
                      <th>Net PnL</th>
                      <th>Avg PnL</th>
                    </tr>
                  </thead>
                  <tbody id="timeDayBody">
                    <tr><td colspan="5" class="muted">No data yet.</td></tr>
                  </tbody>
                </table>
              </div>
            </section>

            <section class="card">
              <h3>Hour-of-Day Performance</h3>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>Hour</th>
                      <th>Trades</th>
                      <th>Win Rate</th>
                      <th>Net PnL</th>
                      <th>Avg PnL</th>
                    </tr>
                  </thead>
                  <tbody id="timeHourBody">
                    <tr><td colspan="5" class="muted">No data yet.</td></tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>

          <div class="tab-panel" data-tab-panel="market">
            <section class="card">
              <div class="card-header">
                <div>
                  <h2>Market Context</h2>
                  <p class="muted">See how exchanges and tokens contribute to performance across the selected range.</p>
                </div>
              </div>
              <p id="marketSummary" class="muted breakdown-summary">Apply filters to load market context.</p>
              <div class="chart-container large-chart">
                <canvas id="marketTimelineChart" aria-label="Market net PnL timeline"></canvas>
              </div>
            </section>

            <section class="card">
              <h3>Token Exposure</h3>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>Token</th>
                      <th>Trades</th>
                      <th>Win Rate</th>
                      <th>Net PnL</th>
                      <th>Avg PnL</th>
                      <th>Volume</th>
                    </tr>
                  </thead>
                  <tbody id="marketTokenBody">
                    <tr><td colspan="6" class="muted">No data yet.</td></tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>

          <div class="tab-panel" data-tab-panel="gas">
            <section class="card">
              <h2>Gas Overview</h2>
              <div class="gas-stats">
                <article>
                  <span>Current Total</span>
                  <strong id="gasTotalNow">-</strong>
                </article>
                <article>
                  <span>24h Consumption</span>
                  <strong id="gasConsumptionDay">-</strong>
                </article>
                <article>
                  <span>Last Deposit</span>
                  <strong id="gasLastDeposit">-</strong>
                </article>
              </div>
            </section>

            <section class="card">
              <h3>Gas Balance Trend</h3>
              <div class="chart-container large-chart">
                <canvas id="gasBalanceChart" aria-label="Gas balance trend"></canvas>
              </div>
            </section>

            <section class="card">
              <h3>Profit vs Gas Consumption</h3>
              <div class="table-wrap">
                <table id="gasOpsTable">
                  <thead>
                    <tr>
                      <th>Window</th>
                      <th>Trades</th>
                      <th>Profit (USD)</th>
                      <th>Gas Consumption</th>
                      <th>Net After Gas</th>
                    </tr>
                  </thead>
                  <tbody id="gasOpsBody">
                    <tr><td colspan="5" class="muted">No data yet.</td></tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>
        </section>
      </div>
    </main>
    <dialog id="rawTradeDialog" class="raw-dialog">
      <div class="raw-dialog-header">
        <strong>Trade Payload</strong>
        <button type="button" id="closeRawDialog" class="mini-btn">Close</button>
      </div>
      <pre id="rawTradeContent"></pre>
    </dialog>
    <footer>
      <small>Reports powered by balances_history &amp; completed_trades. Use saved views to snapshot scenarios.</small>
    </footer>
    <script src="/reports.js"></script>
    <script src="/servers-client.js"></script>
    <script src="/help.js"></script>
    <script src="/theme-switcher.js"></script>
    <script src="/logout.js"></script>
    <script src="/mobile-menu.js"></script>
  </body>
</html>


