<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dex Arbitrage Dashboard</title>
    <script src="/auth-check.js"></script>
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2"></script>
  </head>
  <body>
    <header>
      <div id="brand">
        <img class="brand-img" src="/color_logo.png" onerror="this.src='/color_logo.svg'" alt="Logo" />
        <h1>Dex Arbitrage Dashboard</h1>
      </div>
      <div class="controls">
        <label style="color:var(--muted);font-size:12px">Server:
          <select id="serverSelect"></select>
        </label>
        <a class="nav-link" href="/ml-analysis.html">ML Analysis</a>
        <a class="nav-link" href="/pair-analysis.html">Pair Analysis</a>
        <a class="nav-link" href="/token-analysis.html">Token Analysis</a>
        <a class="nav-link" href="/diff-analysis.html">Diff Analysis</a>
        <a class="nav-link" href="/contract-analysis.html">Contract Analysis</a>
        <a class="nav-link" href="/docs.html">Docs</a>
        <a class="nav-link" href="/servers.html" title="Server settings" aria-label="Server settings">Settings</a>
        <button id="refreshBtn" class="btn-orange" title="Refresh now">Refresh</button>
        <button id="resetZoomBtn" class="btn" title="Reset zoom">Reset Zoom</button>
        <span id="lastUpdated">â€”</span>
      </div>
    </header>

    <main>
      <div class="grid-2">
        <section class="card">
          <h2>Server Status</h2>
          <div id="sdiffStatus"></div>
          <div class="grid-2" style="margin-top: 1rem;">
            <div id="tokensContainer"></div>
            <div id="gasBalanceContainer"></div>
          </div>
          <div class="grid-2" style="margin-top: 1.5rem;">
            <div id="profitStats"></div>
            <div id="tradeStats"></div>
          </div>
        </section>
        <section class="card">
          <h2>Total USDT Balance Over Time <button class="info-btn" data-help="total-chart">i</button></h2>
          <div class="chart-container" style="height: 450px;">
            <canvas id="balancesChart"></canvas>
          </div>
          <div id="totalBalanceSummary" class="muted" style="margin-top:8px"></div>
        </section>
      </div>

      <div class="grid-2">
        <section class="card">
          <h2>DEX Exchange Balances <button class="info-btn" data-help="dex-table">i</button></h2>
          <div id="dexSummary" class="muted"></div>
        <input id="dexSearch" placeholder="Search DEX balances..." />
          <div class="table-wrap">
            <table id="dexBalancesTable">
              <thead>
                <tr>
                  <th>Exchange</th>
                  <th>Token</th>
                  <th>Total</th>
                  <th>Total USDT</th>
                  <th>Current Price</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

        <section class="card">
          <h2>BinanceF (CEX) Balances <button class="info-btn" data-help="cex-table">i</button></h2>
          <div id="cexSummary" class="muted"></div>
          <input id="cexSearch" placeholder="Search CEX balances..." />
          <div class="table-wrap">
            <table id="cexBalancesTable">
              <thead>
                <tr>
                  <th>Token</th>
                  <th>Total</th>
                  <th>USDT Value</th>
                  <th>Total USDT</th>
                  <th>Entry Price</th>
                  <th>Unrealized PnL</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </div>

      <section class="card">
        <h2>DEX vs CEX Comparison</h2>
        <div class="table-wrap">
          <table id="comparisonTable">
            <thead>
              <tr>
                <th>Token</th>
                <th>DEX Total USDT</th>
                <th>CEX Total USDT</th>
                <th>Difference</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card">
        <h2>Completed Trades <button class="info-btn" data-help="trades-table">i</button></h2>
        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap">
          <input id="tradesSearch" placeholder="Search trades..." />
          <label>Show:
            <select id="tradesLimit">
              <option value="100" selected>100</option>
              <option value="500">500</option>
              <option value="1000">1000</option>
              <option value="5000">5000</option>
              <option value="10000">10000</option>
              <option value="200000">200000</option>
            </select> trades
          </label>
          <button id="exportTradesBtn" class="btn">Export to Excel</button>
        </div>
        <div class="table-wrap">
          <table id="tradesTable">
            <thead>
              <tr>
                <th>Pair</th>
                <th>Token</th>
                <th>% Profit</th>
                <th>Net Profit</th>
                <th>Quantity</th>
                <th>Last Updated</th>
                <th>Dex</th>
                <th>Diff</th>
                <th>DexSlip</th>
                <th>CexSlip</th>
                <th>Exec</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>

    <footer>
      <small>Auto-refresh every 2 minutes. Data stored locally in SQLite.</small>
    </footer>

    <script src="/script.js"></script>
    <script src="/help.js"></script>
    <script src="/servers-client.js"></script>
  </body>
</html>
